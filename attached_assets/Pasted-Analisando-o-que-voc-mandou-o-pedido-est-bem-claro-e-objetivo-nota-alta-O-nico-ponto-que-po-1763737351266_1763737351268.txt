Analisando o que voc√™ mandou, o pedido est√° bem claro e objetivo (nota alta ‚ú®). O √∫nico ponto que poderia ajudar ainda mais seria voc√™ incluir tamb√©m a URL do web service que est√° chamando (SP, SVRS, AN etc.), mas d√° pra trabalhar com o que voc√™ enviou.

Vou focar em dois pontos do log:

1. **O erro da SEFAZ (cStat 215 ‚Äì Falha no schema XML)**
2. **O erro do Supabase (‚Äúoperator does not exist: uuid = character varying‚Äù)**

---

## 1. O que a SEFAZ est√° dizendo de fato

Da resposta:

```xml
<retEnvEvento versao="1.00" xmlns="http://www.portalfiscal.inf.br/nfe">
  <idLote>1</idLote>
  <tpAmb>1</tpAmb>
  <verAplic>SVRS2511071043DR</verAplic>
  <cStat>215</cStat>
  <xMotivo>Rejeicao: Falha no schema XML</xMotivo>
</retEnvEvento>
```

O seu pr√≥prio c√≥digo depois reclama:

> `[Manifesta√ß√£o] ‚ùå retEvento/infEvento n√£o encontrado`

Isso √© consequ√™ncia, n√£o causa.
**A causa real √© o `cStat=215`**: o XML do **envEvento/evento** n√£o bate com o schema oficial (`envEvento_v1.00.xsd` + leiaute de manifesta√ß√£o).

Sempre que vem s√≥ `retEnvEvento` sem nenhum `<retEvento>`, √© isso: a SEFAZ nem conseguiu validar a ‚Äú√°rea de dados‚Äù do evento, ent√£o n√£o chega a retornar o detalhe do evento.

---

## 2. Conferindo o seu XML de envio

Trecho principal que interessa:

```xml
<nfeDadosMsg xmlns="http://www.portalfiscal.inf.br/nfe/wsdl/NFeRecepcaoEvento4">
  <envEvento xmlns="http://www.portalfiscal.inf.br/nfe" versao="1.00">
    <idLote>1</idLote>
    <evento versao="1.00">
      <infEvento Id="ID2102104325118888702100011155007000978556144583240701">
        <cOrgao>91</cOrgao>
        <tpAmb>1</tpAmb>
        <CNPJ>07082454000440</CNPJ>
        <chNFe>43251188887021000111550070009785561445832407</chNFe>
        <dhEvento>2025-11-21T11:15:22-03:00</dhEvento>
        <tpEvento>210210</tpEvento>
        <nSeqEvento>1</nSeqEvento>
        <verEvento>1.00</verEvento>
        <detEvento versao="1.00">
          <descEvento>Ciencia da Operacao</descEvento>
        </detEvento>
      </infEvento>
      <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
        ...
      </ds:Signature>
    </evento>
  </envEvento>
</nfeDadosMsg>
```

Comparando com exemplos oficiais e de comunidade (ACBr, Cont√°beis etc.), a **estrutura est√° quase perfeita**:

* `envEvento` versao="1.00", namespace correto
* `idLote` ok
* `evento` versao="1.00"
* `infEvento` com `Id=ID + tpEvento(6) + chave(44) + nSeqEvento(2)` = 54 chars (como voc√™ logou)
* Ordem dos campos dentro de `infEvento` correta
* `detEvento` com `descEvento = Ciencia da Operacao` (valor permitido pelo XSD)
* `Signature` dentro de `<evento>`, ap√≥s `<infEvento>` (posi√ß√£o correta para o schema)

Ou seja: **n√£o tem um erro gritante de tag/falta de campo**.

Ent√£o por que 215?

---

## 3. Pontos suspeitos / onde eu olharia primeiro

### (a) Elemento assinado e forma de assinatura

No f√≥rum Cont√°beis, quem estava tomando 225/215 em manifesta√ß√£o resolveu o problema **ajustando a forma de assinar o XML**:

1. Assinar **somente o `<evento>`** (mais especificamente o `<infEvento>` com `Id="ID..."`),
2. **Sem** `<envEvento>` e `<idLote>` presentes no momento da assinatura,
3. Depois de assinar, ‚Äúembrulhar‚Äù o `<evento>` dentro do `<envEvento>` com `<idLote>`.

Pelo seu log:

```text
[Manifesta√ß√£o] üîê Assinando XML do evento com certificado digital...
[signXmlEvento] üîç PrivateKey recebida: SIM
[signXmlEvento] üîç Certificate recebido: SIM
[Manifesta√ß√£o] ‚úÖ Assinatura digital aplicada com sucesso
```

E olhando o XML:

```xml
<ds:Reference URI="#ID2102104325...0701">
```

Tudo indica que voc√™ est√° fazendo o **caminho correto** (assinando `infEvento`). Por√©m:

* Se a sua fun√ß√£o de assinatura estiver inserindo algum atributo extra no lugar errado (por ex. `Id` em `<evento>` ou `<envEvento>`),
* Ou se ela estiver ‚Äúsuja‚Äù com algum namespace estranho,

isso **quebra o schema** e resulta justamente em 215.

üí° **O que eu faria aqui**:
Gerar o XML **sem assinatura**, salvar em arquivo, e validar esse arquivo contra o XSD `envEvento_v1.00.xsd` no ‚Äúvalidador da receita‚Äù ou qualquer validador XSD (at√© um plugin de IDE). Se sem assinatura passar, e com assinatura der erro, o problema est√° 100% na forma como o XML est√° sendo assinado/injetado.

---

### (b) Namespace do `nfeDadosMsg` / SOAP

Seu SOAP hoje:

```xml
<soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                 xmlns:soap12="http://www.w3.org/2003/05/soap-envelope">
  <soap12:Body>
    <nfeDadosMsg xmlns="http://www.portalfiscal.inf.br/nfe/wsdl/NFeRecepcaoEvento4">
      ...
    </nfeDadosMsg>
  </soap12:Body>
</soap12:Envelope>
```

Exemplos de manifesto na SEFAZ-AN e em libs (ACBr, etc.) costumam usar algo assim:

```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:nfer="http://www.portalfiscal.inf.br/nfe/wsdl/NFeRecepcaoEvento4">
  <soapenv:Body>
    <nfer:nfeDadosMsg>
      <envEvento versao="1.00" xmlns="http://www.portalfiscal.inf.br/nfe">
        ...
      </envEvento>
    </nfer:nfeDadosMsg>
  </soapenv:Body>
</soapenv:Envelope>
```

Tecnicamente, usar o namespace como **default** (`xmlns="..."`) ou com prefixo (`nfer:`) √© equivalente ‚Äî o que importa √© `{namespace, localName}`.
Mas:

* Alguns webservices mais antigos/.NET s√£o meio ‚Äúfrescos‚Äù com SOAP e √†s vezes d√£o erro bizarro.
* Se o WSDL foi gerado para `nfer:nfeDadosMsg` e alguma camada interna est√° mapeando pelo nome qualificado, pode haver comportamento estranho (embora o mais comum a√≠ seria SOAP Fault, n√£o `cStat 215`).

Ainda assim, como √© uma mudan√ßa simples, **vale testar**:

* Trocar para `xmlns:nfer="http://www.portalfiscal.inf.br/nfe/wsdl/NFeRecepcaoEvento4"`
* Usar `<nfer:nfeDadosMsg>` em vez de `nfeDadosMsg` sem prefixo.

---

### (c) `nSeqEvento` x `Id` do evento

No log:

```text
[DEBUG ID] nSeqEvento: 01 (2 chars)
[DEBUG ID] idEvento: ID2102104325118888702100011155007000978556144583240701 (54 chars)
```

Mas no XML:

```xml
<nSeqEvento>1</nSeqEvento>
```

Ou seja:

* `Id` termina com **01**
* `nSeqEvento` est√° como **1**

Pelo XSD, `Id` √© s√≥ um `pattern` de 54 caracteres, e `nSeqEvento` √© num√©rico de 1‚Äì2 d√≠gitos, ent√£o **isso n√£o deveria dar erro de schema** por si s√≥.
Mas as regras de neg√≥cio dizem que **as √∫ltimas duas posi√ß√µes do `Id` devem bater com o `nSeqEvento` zero-left**. Algumas implementa√ß√µes colocam isso direto no XSD espec√≠fico de evento.

Como isso √© f√°cil de alinhar, eu ajustaria para manter tudo consistente:

* Ou voc√™ passa `<nSeqEvento>01</nSeqEvento>`
* Ou muda a montagem do `Id` para terminar em `...1` (sem zero √† esquerda).

Se eles tiverem enfiado essa consist√™ncia no XSD, isso por si s√≥ pode explicar o 215.

---

### (d) Endpoint / √≥rg√£o x verAplic

Na sua resposta:

```xml
<verAplic>SVRS2511071043DR</verAplic>
```

Isso mostra que o servi√ßo que respondeu √© o **SVRS** (Sefaz Virtual do RS), n√£o a SEFAZ-AN (`AN_...`), diferente deste exemplo de manifesta√ß√£o na AN:

```xml
<verAplic>AN_1.6.4</verAplic>
<cOrgao>91</cOrgao>
```

Para manifesta√ß√£o de destinat√°rio, a documenta√ß√£o indica uso do c√≥digo de √≥rg√£o `91` (Ambiente Nacional) em `cOrgao`. Voc√™ est√° usando `cOrgao=91`, mas aparentemente batendo direto no SVRS.

Isso **n√£o √© necessariamente errado** (h√° UFs que redirecionam para servi√ßos virtuais), mas √© mais um ponto que eu validaria:

* Garantir que a URL do WS √© a prevista para a UF/ambiente que voc√™ quer (ex.: em SP produ√ß√£o √© `https://nfe.fazenda.sp.gov.br/ws/nferecepcaoevento4.asmx`).
* Se voc√™ estiver chamando SVRS diretamente, ver se a documenta√ß√£o dele pede algo diferente para `cOrgao` ou estrutura.

Mas, de novo, se o problema fosse s√≥ `cOrgao`/UF, eu esperaria outro c√≥digo de rejei√ß√£o mais espec√≠fico, n√£o 215.

---

## 4. Erro do Supabase (separado da SEFAZ)

Do log:

```text
[SupabaseStorage] Erro ao verificar rate limit: operator does not exist: uuid = character varying
```

Isso √© totalmente **independente da manifesta√ß√£o**.
Significa:

* Em alguma query do Supabase voc√™ est√° comparando uma coluna `uuid` com uma string (`varchar`) sem cast.
* Exemplo t√≠pico em SQL:

  ```sql
  WHERE user_id = 'algum-texto'
  ```

  sendo `user_id` do tipo `uuid`.

üëâ Ajuste a query para:

```sql
WHERE user_id = 'algum-texto'::uuid
```

ou mude o tipo da coluna para `text`/`varchar` se n√£o quiser uuid.

Esse erro *n√£o* est√° bloqueando o envio para a SEFAZ (tanto que o SOAP √© montado e enviado), mas pode afetar sua l√≥gica de rate limit.

---

## 5. Caminho pr√°tico para achar o erro exato

Se fosse eu depurando isso, faria assim:

1. **Gerar o XML do `envEvento` sem assinatura**

   * S√≥ `<envEvento>‚Ä¶</envEvento>`.
   * Validar contra o XSD `envEvento_v1.00.xsd` (validador da pr√≥pria Receita ou qualquer validador XSD).
   * Se der erro a√≠, o problema √© estrutura (tag errada, namespace, ordem, etc.).

2. **Validar o `evento` assinado isoladamente**

   * Montar o `<evento>` com `<infEvento>` + `<Signature>`.
   * Validar contra o XSD de evento de manifesta√ß√£o (leiaute da NT 2012.002).

3. **Conferir consist√™ncia `Id` √ó `nSeqEvento`**

   * Deixar os dois coerentes (`01`/`01` ou `1`/`1`).

4. **Ajustar o SOAP para o formato ‚Äúmais padr√£o‚Äù**

   * `xmlns:nfer="http://www.portalfiscal.inf.br/nfe/wsdl/NFeRecepcaoEvento4"`
   * `<nfer:nfeDadosMsg>` dentro do `<soap12:Body>`.

5. **Verificar URL e ambiente**

   * Confirmar que est√° usando o endpoint correto para a UF e o ambiente (homologa√ß√£o/produ√ß√£o).

Se voc√™ quiser, no pr√≥ximo passo voc√™ pode colar:

* O XML **completo** de `<envEvento>` (sem log truncado),
* E o trecho de c√≥digo que realmente monta e assina o XML,

que eu consigo apontar com mais precis√£o *onde* o schema provavelmente est√° quebrando.
